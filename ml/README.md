# Machine Learning

This folder contains all the data, scripts and the Jupyter notebook required to train the model, load it and use it to make predictions.

# Scripts
## data
The `data` folder contains all the preprocessed files generated by the scripts below

## scripts/holidays
The `holidays` script scrapes a list of holidays from https://kalender-365.be. These are then saved in `{year}.csv` and can be used for the machine learning model.

## scripts/school-vacations
Similarly to the `holidays` script, this script scrapes a list of school vacations from https://onderwijs.vlaanderen.be/nl/schoolvakanties-vorige-schooljaren and saves it as `vacations.csv`.

## scripts/weather
This script scrapes weather data for the past few years from https://meteo.be and saves it as `weather-2016-2019.csv`.

## scripts/make-prediction
This script loads the model and predicts a delay, given a train ID and a timestamp. *:warning: Requires `station_uris_irail.json` (not the regular Infrabel `station_uris.json`!), iRail's `stations.csv` and the exported model and encoders file generated by the `train_model.ipynb` notebook*

## train_model.ipynb
This notebook loads the model that was trained and exported by the Jupyter notebook and uses it to predict a delay, given a train ID and a timestamp.


# Model
The model is made in [catboost](https://catboost.ai/), a machine learning library made by Yandex that uses gradient boosting on decision trees. It's a very fast and easy to use library, mainly because it's great at handling categorical data without having to do one-hot encoding. We trained the model on Google Colab, because it has some very powerful hardware (Xeon and Tesla K80 GPU) for free, which is great for the very resource-heavy training process. To use it, upload the notebook to Google Drive, add a data folder with the iRail `stations.csv` and `station_uris_irai.json` (not the regular Infrabel `station_uris.json`!), open the notebook in Google Colab and run it. It will export the model itself to `model.cbm` and the encoders file to `encoders.pickle`.

## Features:
- **STATION_CUR:** URI of the current station
- *str, categorical* **STATION_DEP:** URI of the departure station
- *str, categorical* **STATION_ARR:** URI of the arrival station
- *int, categorical* **dotw:** Day of the week with an index of 0 (so 0 to 6)
- *bool* **weekend:** Whether the trip is during a weekend or not
- *int, categorical* **month:** Month of the trip (integer, 1 to 12)
- *int* **seconds_since_midnight:** Number of seconds since midnight, used to indicate the time of the day
- *int* **expected_time_station:** Expected time the train stays in the station, according to the Infrabel dataset (departure-arrival)
- *int* **LNG_CUR:** Longitude of the current station
- *int* **LAT_CUR:** Latitude of the current station
- *type* **STOP_CUR:** Expected stop time of the current station according to iRail's `stations.csv`
- *str, categorical* **train_type:** Train ype ('S', 'IC', 'L', etc.)
- *str, categorical* **LINE_ID:** ID of the line ('IC1517')
- *type* **STOP_ARR:** Expected stop time of the arrival station, according to iRail's `stations.csv`
- *type* **STOP_DEP:** Expected stop time of the departure station, according to iRail's `stations.csv`
- *str, categorical* **LINE:** URIs of the departure and arrival stations, separated by an underscore ('http://irail.be/stations/NMBS/008891405_http://irail.be/stations/NMBS/008831765')

To improve accuracy, this model can be extended with the data about the holidays, school vacations and weather. These data are already available in a readable format (see the documentation on the scripts above), but not yet added to the model.