# Reliability Score scripts

This folder contains scripts we used to process the dataset provided by Infrabel.

:warning: *make sure you have Python 3.6 or newer and have installed and activated your Pipenv as described [here](https://github.com/oSoc19/reliability-score-backend/blob/master/README.md)*

## spreadsheets
The data we received from Infrabel was provided as a list of URLs to Excel files with the delay data for every day. The scripts in the `spreadsheets` folder download the CSV files and merge them into one dataset.

## station_uris
This is a collection of scripts that converts the station names used in the Infrabel dataset to iRail station URI's. This makes it easier to later look up extra information about the station.

## csv_splitter
This script splits the big CSV generated by `spreadsheets/one_file.py` into a lot of smaller CSVs for every train ID (like `IC3308.csv`) for the whole year. Then it collects the arrival and departure delays for every day and some statistics and puts all this in even smaller JSON files (the JSON is smaller because it doesn't contain the station URI on every line).

## Building the data set

Tested on Ubuntu 18.04 LTS

1. Enter the `spreadsheets` directory: `cd spreadsheets`
2. Fetch the XLSX files with: `python3 crawler.py`
3. Convert the XLSX files to CSV with `./multiple_core_convert.sh <CORES>`. The parameter `<CORES>` controls the amount of CPU cores you want to spend on this task. Running on 4 cores takes several hours.
4. Combine all the CSV files into a single CSV file by running: `python3 one_file.py`
5. Now enter the `station_uris` directory: `cd .. && cd station_uris`
6. Run the URI conversion script: `python3 station_to_uri.py`. If stations can be matched properly, the script asks for a human intervention (input choice). You can skip this step if you use the pregenerated `station_to_uri.json` file.
7. Now enter the `csv_splitter` directory: `cd .. && cd csv_splitter`
8. Run the splitter: `python3 main.py`. This task takes several hours to process. The output files are available in the `results` directory.
